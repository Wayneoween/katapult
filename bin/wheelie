#!/usr/bin/env ruby

case (command = ARGV.shift)
when 'target'
  app_name = ARGV.shift

  puts 'Creating new Rails application ...'
  system "rails new #{app_name} --skip-test-unit --skip-bundle --database mysql"
  Dir.chdir app_name

  puts
  puts 'Installing wheelie ...'
  File.open('Gemfile', 'a') do |file|
    file.puts "gem 'wheelie'#{ ENV['WHEELIE_GEMFILE_OPTIONS'] }"
  end
  system 'bundle install'
  system 'bundle exec rails generate wheelie:install'

  puts
  puts 'Generating wheelie basics ...'
  system 'bundle exec rails generate wheelie:basics'

  puts
  puts 'Done.'

when 'fire'
  app_model_path = 'lib/wheelie/application_model.rb'

  puts 'Loading katapult ...'
  system 'bin/rails generate wheelie:render ' + app_model_path

else
  puts 'Usage: wheelie [target APP_NAME | fire]'
end
